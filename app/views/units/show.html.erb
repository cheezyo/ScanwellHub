<%- model_class = Unit -%>
<div class="page-header">
  <h1>
  	<%= @unit.unit_id %>
    <% days = (@unit.last_check + 1.year)- DateTime.now %>
    <small> 
    <% if @unit.logunits.count > 0 %>
    	<%= Status.find(@unit.logunits.last.status).name if Status.exists?(@unit.logunits.last.status)%>
    <% end %>
    (<%= days.to_i %> days)
	
	</small>
  </h1>

  <% total = get_total(@unit)%>
 <!--
<%= link_to todos_path(:unit_id => @unit.id), :class => "btn btn-primary" do %>
  To do
  <span class="badge <% if total > 0 %>badge-red <% end %>"><%= total %></span>
<% end %>
-->
<div class="btn-group">
 <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
    To do <span class="badge <% if total > 0 %>badge-red <% end %>"><%= total %></span>
  </button>
  <ul class="dropdown-menu grey" role="menu" >

  	 <% get_todos_for_unit(@unit).each do |c|%>
     <li><%= link_to c do %>
    	<%= c.title %>
    	<% if c.level == "high" %>
    	<% color = "badge-red" %>
    	<% elsif c.level == "medium"%>
    	<% color = "badge-orange" %>
    	<% elsif c.level == "low"%>
    	<% color = "badge-green" %>
    	<% end %>
    	<span class="badge <%= color %>"> </span>
    	<% end %>
	</li>
     <li class="divider"></li>
    
    <% end %>
    <% get_todos_for_components_on_unit(@unit).each do |c|%>
    <li><%= link_to c do %>
    	<%= c.title %>
    	<% if c.level == "high" %>
    	<% color = "badge-red" %>
    	<% elsif c.level == "medium"%>
    	<% color = "badge-orange" %>
    	<% elsif c.level == "low"%>
    	<% color = "badge-green" %>
    	<% end %>
    	<span class="badge <%= color %>"> </span>
    	<% end %>
	</li>
     <li class="divider"></li>
    
    <% end %>
    <% if total > 1%>
   <li><%= link_to 'Show all...', todos_path(:unit_id => @unit.id)%></li>
   <% end %>
    </ul>
 </div> 
</div>
<dl class="dl-horizontal">
	<% if @unit.company_id != nil %>
 <dt><strong>Owner:</strong></dt>
  <dd><%= Company.find(@unit.company_id).name %></dd>
 <% end %>
  
  <dt><strong><%= model_class.human_attribute_name(:last_check) %>:</strong></dt>
  <dd><%= @unit.last_check %></dd>
  <dt><strong><%= model_class.human_attribute_name(:approved) %>:</strong></dt>
  <dd><% if @unit.approved %>
  	Yes
  	<% else %>
  	No
  	<% end %>
  </dd>
  
  <dt><strong><%= model_class.human_attribute_name(:comment) %>:</strong></dt>
  <dd><%= @unit.comment %></dd>

</dl>
<h5>Components on this unit</h5>

<table class="table table-striped">
  <thead>
    <tr>
      
      	<th>Serial number</th>
   
	    <th>Type</th>
	    <th>Last check</th>
	    <th>Calibrated</th>
	    <th>Comment</th>
    
    
    </tr>
  </thead>
  <tbody>
    <% @unit.components.order("brand_id desc").each do |c|%>
    
      <tr>
        
        <td><%= link_to c.comp_id, c %></td>
         <td><%= Brand.find(c.brand_id).name %></td>
        <td><%= c.last_check %></td>
        <td><%= c.calibrated %></td>
        <td><% if c.commet != nil %>
        	<%= c.commet.truncate(15)%>
        	<%end %>
        </td>
        </tr>
        
        <% end %>
        </tbody>
        </table>
<div class="form-actions">
	<%= link_to "History log", logunits_path(:unit_id => @unit.id), :class => 'btn btn-primary' %>
	<% if ! is_in_transit(@unit) %>
	<%= link_to "Check in unit", recive_logunits_path(:logunit_id => @unit.logunits.last.id ), :class => 'btn btn-primary' %>
	<% else  %>
	<%= link_to "Send unit", new_logunit_path( :unit_id => @unit.id ), :class => 'btn btn-primary'  %>
	<% end %>
	<%= link_to "Add task", new_unit_todo_path(:unit_id => @unit.id), :class => 'btn btn-primary' %>
	
  <%= link_to t('.back', :default => t("helpers.links.back")),
              units_path, :class => 'btn'  %>
  <%= link_to t('.edit', :default => t("helpers.links.edit")),
              edit_unit_path(@unit), :class => 'btn' %>
  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              unit_path(@unit),
              :method => 'delete',
              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              :class => 'btn btn-danger' %>
</div>
